<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<style> rect {fill: steelblue; stroke: black; }</style>
<style> #tooltip {
      opacity: 0;
      position: absolute;
      text-align:center;
      width: 240px; height: 60px;
      background: lightgray;
      border: 0px;
} </style>

<head>
  <title>Marvin Mui Data Visualization Project 2 </title>
</head>

<body onload='init()'>
<div id="tooltip"></div>>
<h1 id="h1">Cylinders vs City MPG</h1>
<svg width=300 height=300>
</svg>

<button id='1' onclick="sceneOne()">Click</button>
<script>
async function init() {
    xd = [0,12];
    xr = [0,600];
    <!--xs = d3.scaleLog(xd,xr);-->
    xs = d3.scaleLinear().domain(xd).range(xr);

    yd = [10,150];
    yr = [600,0];
    ys = d3.scaleLog(yd,yr);

    const data = await d3.csv("https://flunky.github.io/cars2017.csv");
    console.log(data);
    var tooltip = d3.select("#tooltip");

    const type = d3.annotationLabel;

    const annotations = [{
    note: {
      label: "Longer text to show text wrapping",
      bgPadding: 20,
      title: "Annotations :)"
    },
    //can use x, y directly instead of data
    data: { date: "18-Sep-09", close: 185.02 },
    className: "show-bg",
    dy: 137,
    dx: 162
  }]

const parseTime = d3.timeParse("%d-%b-%y")
const timeFormat = d3.timeFormat("%d-%b-%y")

const x = d3.scaleTime().range([0, 800])
const y = d3.scaleLinear().range([300, 0])

const makeAnnotations = d3.annotation()
  .editMode(true)
  .notePadding(15)
  .type(type)
  .accessors({
    x: d => x(parseTime(d.date)),
    y: d => y(d.close)
  })
  .accessorsInverse({
     date: d => timeFormat(x.invert(d.x)),
     close: d => y.invert(d.y)
  })
  .annotations(annotations)

d3.select("svg")
  .append("g")
  .attr("class", "annotation-group")
  .call(makeAnnotations)

    d3.select('svg')
      .attr('width', 700)
      .attr('height', 700)
      .append('g')
        .attr('transform', 'translate(50,50)')
      .selectAll('circle')
      .data(data)
      .enter()
      .append('circle')
        .attr('cx', function(d,i) {return xs(d.EngineCylinders);})
        .attr('cy', function(d,i) {return ys(Number(d.AverageCityMPG));})
        .attr('r', function(d,i) {return 4;})
      .on("mouseover", function(d,i) {
          tooltip.style("opacity", 1)
                 .style("left", (d3.event.pageX + 10) + "px")
                 .style("top", (d3.event.pageY - 10) + "px")
                 .html("Make: " + d.Make + "<br># of Cylinders: " + d.EngineCylinders + "<br>Average MPG in the City: " + d.AverageCityMPG);
          d3.select(this).attr('opacity', '0.85');
      })
      .on("mouseout", function() {
          tooltip.style("opacity", 0);
          d3.select(this).attr('opacity', '1');
      });


    d3.select('svg').append('g')
      .attr('transform', 'translate(50,50)')
      .call(d3.axisLeft(ys)
        .tickValues([10,20,50,100])
        .tickFormat(d3.format("~s")));

    d3.select('svg').append('g')
      .attr('transform', 'translate(50,650)')
      .call(d3.axisBottom(xs)
        .tickFormat(d3.format("~s")));

}

async function sceneOne() {
    console.log("transition One");
    d3.selectAll("svg > *").remove();
    document.getElementById('h1').innerHTML = "Cylinders vs Highway MPG";

    xd = [0,12];
    xr = [0,600];
    <!--xs = d3.scaleLog(xd,xr);-->
    xs = d3.scaleLinear().domain(xd).range(xr);

    yd = [10,150];
    yr = [600,0];
    ys = d3.scaleLog(yd,yr);

    const data = await d3.csv("https://flunky.github.io/cars2017.csv");
    console.log(data);
    var tooltip = d3.select("#tooltip");

    d3.select('svg')
      .attr('width', 700)
      .attr('height', 700)
      .append('g')
        .attr('transform', 'translate(50,50)')
      .selectAll('circle')
      .data(data)
      .enter()
      .append('circle')
        .attr('cx', function(d,i) {return xs(d.EngineCylinders);})
        .attr('cy', function(d,i) {return ys(Number(d.AverageHighwayMPG));})
        .attr('r', function(d,i) {return 4;})
      .on("mouseover", function(d,i) {
          tooltip.style("opacity", 1)
                 .style("left", (d3.event.pageX + 10) + "px")
                 .style("top", (d3.event.pageY - 10) + "px")
                 .html("Make: " + d.Make + "<br># of Cylinders: " + d.EngineCylinders + "<br>Average MPG on Highways: " + d.AverageHighwayMPG);
          d3.select(this).attr('opacity', '0.85');
      })
      .on("mouseout", function() {
          tooltip.style("opacity", 0);
          d3.select(this).attr('opacity', '1');
      });

    d3.select('svg').append('g')
      .attr('transform', 'translate(50,50)')
      .call(d3.axisLeft(ys)
        .tickValues([10,20,50,100])
        .tickFormat(d3.format("~s")));

    d3.select('svg').append('g')
      .attr('transform', 'translate(50,650)')
      .call(d3.axisBottom(xs)
        .tickFormat(d3.format("~s")));

    document.getElementById("1").onclick = sceneTwo;
}

async function sceneTwo() {
    document.getElementById('h1').innerHTML = "Fuel Type vs Average City MPG";
    d3.selectAll("svg > *").remove();

    console.log("transition Two");

    const data = await d3.csv("https://flunky.github.io/cars2017.csv");
    var tooltip = d3.select('#tooltip');

    const avg_city_mpg = [0,0,0];
    const avg_hw_mpg = [0,0,0];

    const fuel_count = [0,0,0];

    for (let i = 0; i < data.length; i++) {

      if (data[i].Fuel == "Gasoline")
        {
          avg_city_mpg[0] += Number(data[i].AverageCityMPG);
          avg_hw_mpg[0] += Number(data[i].AverageHighwayMPG);
          fuel_count[0] += 1;
        }
      if (data[i].Fuel == "Diesel")
        {
          avg_city_mpg[1] += Number(data[i].AverageCityMPG);
          avg_hw_mpg[1] += Number(data[i].AverageHighwayMPG);
          fuel_count[1] += 1;
        }
      if (data[i].Fuel == "Electricity")
        {
          avg_city_mpg[2] += Number(data[i].AverageCityMPG);
          avg_hw_mpg[2] += Number(data[i].AverageHighwayMPG);
          fuel_count[2] += 1;
        }
    }

    avg_city_mpg[0] /= fuel_count[0];
    avg_city_mpg[1] /= fuel_count[1];
    avg_city_mpg[2] /= fuel_count[2];

    avg_hw_mpg[0] /= fuel_count[0];
    avg_hw_mpg[1] /= fuel_count[1];
    avg_hw_mpg[2] /= fuel_count[2];

    console.log(avg_city_mpg);
    console.log(avg_hw_mpg);

    xd = [0,2];
    xr = [0,600];
    xs = d3.scaleLinear().domain(xd).range(xr);

    hd = [0,120];
    hr = [0,600];
    hs = d3.scaleLinear().domain(hd).range(hr);

    yd = [0,120];
    yr = [600,0];
    ys = d3.scaleLinear().domain(yd).range(yr);

    xaxisd = ["Gasoline", "Diesel", "Electricity"];
    xaxis = d3.scaleBand()
              .domain(xaxisd)
              .range([0,600]);

    width = d3.scaleBand()
              .domain([0, 1, 2])
              .range([0,600]);

    d3.select('svg')
      .attr('width', 700)
      .attr('height', 700)
      .append('g')
        .attr('transform', 'translate(50,50)')
      .selectAll('rect')
      .data(avg_city_mpg)
      .enter()
      .append('rect')
        .attr('x', function(d,i) {return width(i);})
        .attr('y', function(d,i) {return 600-hs(d);})
        .attr('width',function(d,i) {return xaxis.bandwidth();})
        .attr('height',function(d,i) {return hs(d);})
      .on("mouseover", function(d,i) {
          tooltip.style("opacity", 1)
                 .style("left", (d3.event.pageX + 10) + "px")
                 .style("top", (d3.event.pageY - 10) + "px")
                 .html("Average MPG for " + xaxisd[i] + ": " + d + "<br>Over a sample of " + fuel_count[i] + " different car makes");
          d3.select(this).attr('opacity', '0.85');
      })
      .on("mouseout", function() {
          tooltip.style("opacity", 0);
          d3.select(this).attr('opacity', '1');
      });

    d3.select('svg').append('g')
      .attr('transform', 'translate(50,50)')
      .call(d3.axisLeft(ys)
        .tickValues([10,20,50,100])
        .tickFormat(d3.format("~s")));

    d3.select('svg').append('g')
      .attr('transform', 'translate(50,650)')
      .call(d3.axisBottom(xaxis));

    document.getElementById("1").onclick = sceneThree;


}

async function sceneThree() {
    document.getElementById('h1').innerHTML = "Thanks for reading my project!";
    d3.selectAll("svg > *").remove();
    document.getElementById("1").remove();
}
</script>
</body>
</html>